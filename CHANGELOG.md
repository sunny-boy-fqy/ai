# 更新日志

所有重要的更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [0.2.0] - 2025-02-16

### 新增
- ✨ **API 调用重试机制**
  - 失败时自动重试最多 3 次
  - 指数退避延迟（1s, 2s, 4s）
  - 支持网络错误、超时、速率限制等场景
- ✨ **日志系统**
  - 新增 `tools/logger.py` 日志模块
  - 支持 DEBUG、INFO、WARN、ERROR 四个级别
  - `--debug` 或 `-d` 参数启用调试模式
- ✨ **任务恢复功能**
  - `ai work --resume` 恢复未完成的任务
  - 自动检测中断的任务状态
  - 交互式确认继续执行
- ✨ **智能上下文管理**
  - 超过 50 条消息时自动压缩
  - 保留最近 15 条消息
  - 使用模型生成历史摘要
- ✨ **并行任务执行**
  - `assign_tasks_parallel` 工具同时分配多个任务
  - 可配置最大并发数（默认 3）
  - 使用信号量控制并发
- ✨ **进度可视化**
  - 彩色进度条显示
  - 实时显示完成/失败数量
  - 执行耗时统计

### 修改
- 📝 更新帮助说明，添加新功能参数
- 📝 更新 README.md 文档
- 🔧 重构 ModelInterface，添加重试装饰器
- 🔧 LeaderAI 添加智能上下文压缩方法

### 修复
- 🐛 修复上下文溢出导致的问题
- 🐛 修复任务中断后无法恢复的问题

## [0.1.2] - 2025-02-14

### 修复
- BUG 修复 Leader AI 无法调用 MCP 插件的问题
  - 添加 `ModelInterface.call_with_messages()` 方法支持完整消息历史
  - `process_user_input()` 现在正确获取并传递 MCP 工具定义
  - 实现 `_handle_tool_calls_loop()` 处理工具调用循环
  - 添加进化工具（search_plugin, install_plugin, analyze_gap）
- BUG 修复 Worker AI 无法调用 MCP 插件的问题
  - Worker 执行前重新初始化 MCP 管理器
  - 使用 `call_with_messages()` 保持消息历史
  - 正确处理工具调用结果并继续对话

## [0.1.1] - 2025-02-14

### 新增
- ✨ 多行输入支持
  - 反斜杠续行（`\` 结尾）
  - 三引号多行块（`"""`）
  - 三个反引号多行块（```）
- ✨ 异常 token 自动清理
  - 清理 `<|xxx|>` 格式的模型内部标记
  - 清理残留的函数调用片段
- ✨ Leader-Worker 模式
  - 完整的任务规划和执行系统
  - Leader AI 智能规划和监控
  - Worker AI 自动执行任务
  - 实时进度显示

### 修改
- 📝 合并 README.md 和 README_LW.md
- 📝 完善 README 文档，添加详细使用说明

### 修复
- 🐛 修复模型输出异常 token 的问题
- 🐛 修复某些模型不返回结构化工具调用的问题

## [0.1.0] - 2025-02-13

### 新增
- 🎉 初始发布
- ✨ 基础对话功能
  - `ai ask` 即时问答
  - `ai chat` 对话模式
  - 历史记录管理
- ✨ 供应商管理
  - 多供应商支持
  - 模型切换
  - API 密钥管理
- ✨ MCP 插件系统
  - 自动发现和安装
  - 10+ 内置插件
  - 插件搜索功能
- ✨ 工作区管理
  - 安全的文件访问控制
  - 多目录支持
- ✨ 任务系统
  - 一次性、周期、定时任务
  - 守护进程支持
- ✨ 配置同步
  - Git 仓库同步

---

## 版本说明

### 版本号格式

- **主版本号**: 不兼容的 API 更改
- **次版本号**: 向后兼容的功能新增
- **修订号**: 向后兼容的问题修复

### 更新类型

- `新增` - 新功能
- `修改` - 现有功能的更改
- `弃用` - 即将移除的功能
- `移除` - 已移除的功能
- `修复` - Bug 修复
- `安全` - 安全相关修复
